# Migration `20200903175029`

This migration has been generated by Alan at 9/3/2020, 7:50:29 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "PostStatus" AS ENUM ('draft', 'published');

CREATE TABLE "public"."User" (
"id" text  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL ,
"name" text   ,
"email" text  NOT NULL ,
"hashedPassword" text   ,
"role" text  NOT NULL DEFAULT E'user',
"bio" text  NOT NULL DEFAULT E'',
PRIMARY KEY ("id"))

CREATE TABLE "public"."Session" (
"id" text  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL ,
"expiresAt" timestamp(3)   ,
"handle" text  NOT NULL ,
"userId" text   ,
"hashedSessionToken" text   ,
"antiCSRFToken" text   ,
"publicData" text   ,
"privateData" text   ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."Post" (
"id" text  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL ,
"title" text  NOT NULL ,
"intro" text  NOT NULL ,
"content" text  NOT NULL ,
"userId" text   ,
"status" "PostStatus" NOT NULL DEFAULT E'draft',
PRIMARY KEY ("id"))

CREATE TABLE "public"."Comment" (
"id" text  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL ,
"content" text  NOT NULL ,
"userId" text   ,
"postId" text   ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."Tag" (
"id" text  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)  NOT NULL ,
"name" text  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."_UserFollows" (
"A" text  NOT NULL ,
"B" text  NOT NULL )

CREATE TABLE "public"."_Favorites" (
"A" text  NOT NULL ,
"B" text  NOT NULL )

CREATE TABLE "public"."_PostToTag" (
"A" text  NOT NULL ,
"B" text  NOT NULL )

CREATE UNIQUE INDEX "User.email_unique" ON "public"."User"("email")

CREATE UNIQUE INDEX "Session.handle_unique" ON "public"."Session"("handle")

CREATE UNIQUE INDEX "Tag.name_unique" ON "public"."Tag"("name")

CREATE UNIQUE INDEX "_UserFollows_AB_unique" ON "public"."_UserFollows"("A","B")

CREATE  INDEX "_UserFollows_B_index" ON "public"."_UserFollows"("B")

CREATE UNIQUE INDEX "_Favorites_AB_unique" ON "public"."_Favorites"("A","B")

CREATE  INDEX "_Favorites_B_index" ON "public"."_Favorites"("B")

CREATE UNIQUE INDEX "_PostToTag_AB_unique" ON "public"."_PostToTag"("A","B")

CREATE  INDEX "_PostToTag_B_index" ON "public"."_PostToTag"("B")

ALTER TABLE "public"."Session" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Post" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Comment" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Comment" ADD FOREIGN KEY ("postId")REFERENCES "public"."Post"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."_UserFollows" ADD FOREIGN KEY ("A")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_UserFollows" ADD FOREIGN KEY ("B")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_Favorites" ADD FOREIGN KEY ("A")REFERENCES "public"."Post"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_Favorites" ADD FOREIGN KEY ("B")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_PostToTag" ADD FOREIGN KEY ("A")REFERENCES "public"."Post"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_PostToTag" ADD FOREIGN KEY ("B")REFERENCES "public"."Tag"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200903175029
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,91 @@
+// This is your Prisma schema file,
+// learn more about it in the docs: https://pris.ly/d/prisma-schema
+
+// datasource sqlite {
+//   provider = "sqlite"
+//   url = "***"
+// }
+
+// SQLite is easy to start with, but if you use Postgres in production
+// you should also use it in development with the following:
+datasource postgresql {
+  provider = "postgresql"
+  url = "***"
+}
+
+generator client {
+  provider        = "prisma-client-js"
+  previewFeatures = ["transactionApi", "connectOrCreate"]
+}
+
+// --------------------------------------
+
+enum PostStatus {
+  draft
+  published
+}
+
+model User {
+  id             String    @id @default(uuid())
+  createdAt      DateTime  @default(now())
+  updatedAt      DateTime  @updatedAt
+  name           String?
+  email          String    @unique
+  hashedPassword String?
+  role           String    @default("user")
+  sessions       Session[]
+  posts          Post[]
+  followedBy     User[]    @relation("UserFollows", references: [id])
+  following      User[]    @relation("UserFollows", references: [id])
+  favorites      Post[]    @relation("Favorites", references: [id])
+  comments       Comment[]
+  bio            String    @default("")
+}
+
+model Session {
+  id                 String    @id @default(uuid())
+  createdAt          DateTime  @default(now())
+  updatedAt          DateTime  @updatedAt
+  expiresAt          DateTime?
+  handle             String    @unique
+  user               User?     @relation(fields: [userId], references: [id])
+  userId             String?
+  hashedSessionToken String?
+  antiCSRFToken      String?
+  publicData         String?
+  privateData        String?
+}
+
+model Post {
+  id          String     @id @default(uuid())
+  createdAt   DateTime   @default(now())
+  updatedAt   DateTime   @updatedAt
+  title       String
+  intro       String
+  content     String
+  tags        Tag[]      @relation(references: [id])
+  User        User?      @relation(fields: [userId], references: [id])
+  userId      String?
+  favoritedBy User[]     @relation("Favorites", references: [id])
+  comments    Comment[]
+  status      PostStatus @default(draft)
+}
+
+model Comment {
+  id        String   @id @default(uuid())
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  content   String
+  user      User?    @relation(fields: [userId], references: [id])
+  userId    String?
+  post      Post?    @relation(fields: [postId], references: [id])
+  postId    String?
+}
+
+model Tag {
+  id        String   @id @default(uuid())
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  name      String   @unique
+  posts     Post[]   @relation(references: [id])
+}
```


